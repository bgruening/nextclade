$schema: http://json-schema.org/draft-07/schema#
title: VirusProperties
description: Contains external configuration and data specific for a particular pathogen
type: object
required:
- schemaVersion
properties:
  schemaVersion:
    type: string
  attributes:
    type: object
    additionalProperties:
      $ref: '#/definitions/AnyType'
  shortcuts:
    type: array
    items:
      type: string
  meta:
    $ref: '#/definitions/DatasetMeta'
  files:
    $ref: '#/definitions/DatasetFiles'
  defaultCds:
    type:
    - string
    - 'null'
  cdsOrderPreference:
    type: array
    items:
      type: string
  mutLabels:
    default: {}
    allOf:
    - $ref: '#/definitions/LabelledMutationsConfig'
  qc:
    anyOf:
    - $ref: '#/definitions/QcConfig'
    - type: 'null'
  generalParams:
    anyOf:
    - $ref: '#/definitions/NextcladeGeneralParamsOptional'
    - type: 'null'
  alignmentParams:
    anyOf:
    - $ref: '#/definitions/AlignPairwiseParamsOptional'
    - type: 'null'
  treeBuilderParams:
    anyOf:
    - $ref: '#/definitions/TreeBuilderParamsOptional'
    - type: 'null'
  aaChangesParams:
    anyOf:
    - $ref: '#/definitions/AaChangesParamsOptional'
    - type: 'null'
  phenotypeData:
    type:
    - array
    - 'null'
    items:
      $ref: '#/definitions/PhenotypeData'
  aaMotifs:
    type: array
    items:
      $ref: '#/definitions/AaMotifsDesc'
  versions:
    type: array
    items:
      $ref: '#/definitions/DatasetVersion'
  version:
    anyOf:
    - $ref: '#/definitions/DatasetVersion'
    - type: 'null'
  compatibility:
    anyOf:
    - $ref: '#/definitions/DatasetCompatibility'
    - type: 'null'
definitions:
  AnyType:
    anyOf:
    - type: string
    - type: integer
      format: int
    - type: number
      format: double
    - type: boolean
    - type: array
      items:
        $ref: '#/definitions/AnyType'
    - type: object
      additionalProperties:
        $ref: '#/definitions/AnyType'
    - type: 'null'
  DatasetMeta:
    type: object
    properties:
      source code:
        type:
        - string
        - 'null'
      bugs:
        type:
        - string
        - 'null'
      authors:
        type: array
        items:
          type: string
  DatasetFiles:
    type: object
    properties:
      reference:
        type:
        - string
        - 'null'
      pathogenJson:
        type:
        - string
        - 'null'
      genomeAnnotation:
        type:
        - string
        - 'null'
      treeJson:
        type:
        - string
        - 'null'
      examples:
        type:
        - string
        - 'null'
      readme:
        type:
        - string
        - 'null'
      changelog:
        type:
        - string
        - 'null'
  LabelledMutationsConfig:
    type: object
    properties:
      nucMutLabelMap:
        type: object
        additionalProperties:
          type: array
          items:
            type: string
  QcConfig:
    type: object
    properties:
      schemaVersion:
        default: ''
        type: string
      missingData:
        default:
          enabled: false
          missingDataThreshold: 0.0
          scoreBias: 0.0
        allOf:
        - $ref: '#/definitions/QcRulesConfigMissingData'
      mixedSites:
        default:
          enabled: false
          mixedSitesThreshold: 0
        allOf:
        - $ref: '#/definitions/QcRulesConfigMixedSites'
      privateMutations:
        default:
          enabled: false
          weightReversionSubstitutions: 0.0
          weightReversionDeletions: 0.0
          weightLabeledSubstitutions: 0.0
          weightLabeledDeletions: 0.0
          weightUnlabeledSubstitutions: 0.0
          weightUnlabeledDeletions: 0.0
          typical: 0.0
          cutoff: 0.0
        allOf:
        - $ref: '#/definitions/QcRulesConfigPrivateMutations'
      snpClusters:
        default:
          enabled: false
          windowSize: 0
          clusterCutOff: 0
          scoreWeight: 0.0
        allOf:
        - $ref: '#/definitions/QcRulesConfigSnpClusters'
      frameShifts:
        default:
          enabled: false
          scoreWeight: 75.0
        allOf:
        - $ref: '#/definitions/QcRulesConfigFrameShifts'
      stopCodons:
        default:
          enabled: false
          scoreWeight: 75.0
        allOf:
        - $ref: '#/definitions/QcRulesConfigStopCodons'
  QcRulesConfigMissingData:
    type: object
    properties:
      enabled:
        default: false
        type: boolean
      missingDataThreshold:
        default: 0.0
        type: number
        format: double
      scoreBias:
        default: 0.0
        type: number
        format: double
  QcRulesConfigMixedSites:
    type: object
    properties:
      enabled:
        default: false
        type: boolean
      mixedSitesThreshold:
        default: 0
        type: integer
        format: uint
        minimum: 0.0
  QcRulesConfigPrivateMutations:
    type: object
    properties:
      enabled:
        default: false
        type: boolean
      weightReversionSubstitutions:
        default: 1.0
        type: number
        format: double
      weightReversionDeletions:
        default: 1.0
        type: number
        format: double
      weightLabeledSubstitutions:
        default: 1.0
        type: number
        format: double
      weightLabeledDeletions:
        default: 1.0
        type: number
        format: double
      weightUnlabeledSubstitutions:
        default: 1.0
        type: number
        format: double
      weightUnlabeledDeletions:
        default: 1.0
        type: number
        format: double
      typical:
        default: 0.0
        type: number
        format: double
      cutoff:
        default: 0.0
        type: number
        format: double
  QcRulesConfigSnpClusters:
    type: object
    properties:
      enabled:
        default: false
        type: boolean
      windowSize:
        default: 0
        type: integer
        format: uint
        minimum: 0.0
      clusterCutOff:
        default: 0
        type: integer
        format: uint
        minimum: 0.0
      scoreWeight:
        default: 0.0
        type: number
        format: double
  QcRulesConfigFrameShifts:
    type: object
    properties:
      enabled:
        default: false
        type: boolean
      ignoredFrameShifts:
        type: array
        items:
          $ref: '#/definitions/FrameShiftLocation'
      scoreWeight:
        default: 75.0
        type: number
        format: double
  FrameShiftLocation:
    type: object
    properties:
      cdsName:
        default: ''
        type: string
      codonRange:
        default:
          begin: 0
          end: 0
        allOf:
        - $ref: '#/definitions/Range_for_Position'
  Range_for_Position:
    description: |-
      Range of positions in a given 1-dimensional coordinate space.

      The coordinate space type parameter ensures that positions and ranges in different coordinate spaces have different Rust types and they cannot be used interchangeably.
    type: object
    required:
    - begin
    - end
    properties:
      begin:
        $ref: '#/definitions/Position'
      end:
        $ref: '#/definitions/Position'
  Position:
    type: integer
    format: int
  QcRulesConfigStopCodons:
    type: object
    properties:
      enabled:
        default: false
        type: boolean
      ignoredStopCodons:
        type: array
        items:
          $ref: '#/definitions/StopCodonLocation'
      scoreWeight:
        default: 75.0
        type: number
        format: double
  StopCodonLocation:
    type: object
    required:
    - cdsName
    - codon
    properties:
      cdsName:
        type: string
      codon:
        type: integer
        format: uint
        minimum: 0.0
  NextcladeGeneralParamsOptional:
    type: object
    properties:
      includeReference:
        description: Whether to include aligned reference nucleotide sequence into output nucleotide sequence FASTA file and reference peptides into output peptide FASTA files.
        type:
        - boolean
        - 'null'
      includeNearestNodeInfo:
        description: Whether to include the list of nearest nodes to the outputs
        type:
        - boolean
        - 'null'
      inOrder:
        description: |-
          Emit output sequences in-order.

          With this flag the program will wait for results from the previous sequences to be written to the output files before writing the results of the next sequences, preserving the same order as in the input file. Due to variable sequence processing times, this might introduce unnecessary waiting times, but ensures that the resulting sequences are written in the same order as they occur in the inputs (except for sequences which have errors). By default, without this flag, processing might happen out of order, which is faster, due to the elimination of waiting, but might also lead to results written out of order - the order of results is not specified and depends on thread scheduling and processing times of individual sequences.

          This option is only relevant when `--jobs` is greater than 1 or is omitted.

          Note: the sequences which trigger errors during processing will be omitted from outputs, regardless of this flag.
        type:
        - boolean
        - 'null'
      replaceUnknown:
        description: |-
          Replace unknown nucleotide characters with 'N'

          By default, the sequences containing unknown nucleotide characters are skipped with a warning - they are not analyzed and not included into results. If this flag is provided, then before the alignment, all unknown characters are replaced with 'N'. This replacement allows to analyze these sequences.

          The following characters are considered known:  '-', 'A', 'B', 'C', 'D', 'G', 'H', 'K', 'M', 'N', 'R', 'S', 'T', 'V', 'W', 'Y'
        type:
        - boolean
        - 'null'
  AlignPairwiseParamsOptional:
    type: object
    properties:
      alignmentPreset:
        description: Alignment parameter presets. EXPERIMENTAL feature subject to adjustments.
        anyOf:
        - $ref: '#/definitions/AlignmentPreset'
        - type: 'null'
      minLength:
        description: |-
          Minimum length of nucleotide sequence to consider for alignment.

          If a sequence is shorter than that, alignment will not be attempted and a warning will be emitted. When adjusting this parameter, note that alignment of short sequences can be unreliable.
        type:
        - integer
        - 'null'
        format: uint
        minimum: 0.0
      penaltyGapExtend:
        description: Penalty for extending a gap in alignment. If zero, all gaps regardless of length incur the same penalty.
        type:
        - integer
        - 'null'
        format: int32
      penaltyGapOpen:
        description: Penalty for opening of a gap in alignment. A higher penalty results in fewer gaps and more mismatches. Should be less than `--penalty-gap-open-in-frame` to avoid gaps in genes.
        type:
        - integer
        - 'null'
        format: int32
      penaltyGapOpenInFrame:
        description: As `--penalty-gap-open`, but for opening gaps at the beginning of a codon. Should be greater than `--penalty-gap-open` and less than `--penalty-gap-open-out-of-frame`, to avoid gaps in genes, but favor gaps that align with codons.
        type:
        - integer
        - 'null'
        format: int32
      penaltyGapOpenOutOfFrame:
        description: As `--penalty-gap-open`, but for opening gaps in the body of a codon. Should be greater than `--penalty-gap-open-in-frame` to favor gaps that align with codons.
        type:
        - integer
        - 'null'
        format: int32
      penaltyMismatch:
        description: Penalty for aligned nucleotides or amino acids that differ in state during alignment. Note that this is redundantly parameterized with `--score-match`
        type:
        - integer
        - 'null'
        format: int32
      scoreMatch:
        description: Score for matching states in nucleotide or amino acid alignments.
        type:
        - integer
        - 'null'
        format: int32
      maxBandArea:
        description: Maximum area of the band in the alignment matrix. Alignments with large bands are slow to compute and require substantial memory. Alignment of sequences requiring bands with area larger than this value, will not be attempted and a warning will be emitted.
        type:
        - integer
        - 'null'
        format: uint
        minimum: 0.0
      retryReverseComplement:
        description: Retry seed matching step with a reverse complement if the first attempt failed
        type:
        - boolean
        - 'null'
      noTranslatePastStop:
        description: If this flag is present, the amino acid sequences will be truncated at the first stop codon, if mutations or sequencing errors cause premature stop codons to be present. No amino acid mutations in the truncated region will be recorded.
        type:
        - boolean
        - 'null'
      leftTerminalGapsFree:
        type:
        - boolean
        - 'null'
      rightTerminalGapsFree:
        type:
        - boolean
        - 'null'
      excessBandwidth:
        description: Excess bandwidth for internal stripes.
        type:
        - integer
        - 'null'
        format: int32
      terminalBandwidth:
        description: Excess bandwidth for terminal stripes.
        type:
        - integer
        - 'null'
        format: int32
      gapAlignmentSide:
        description: 'Whether to align gaps on the left or right side if equally parsimonious. Default: left'
        anyOf:
        - $ref: '#/definitions/GapAlignmentSide'
        - type: 'null'
      kmerLength:
        description: Length of exactly matching k-mers used in the seed alignment of the query to the reference.
        type:
        - integer
        - 'null'
        format: uint
        minimum: 0.0
      kmerDistance:
        description: Interval of successive k-mers on the query sequence. Should be small compared to the query length.
        type:
        - integer
        - 'null'
        format: uint
        minimum: 0.0
      allowedMismatches:
        description: Exactly matching k-mers are extended to the left and right until more than `allowed_mismatches` are observed in a sliding window (`window_size`).
        type:
        - integer
        - 'null'
        format: uint
        minimum: 0.0
      windowSize:
        description: Size of the window within which mismatches are accumulated during seed extension
        type:
        - integer
        - 'null'
        format: uint
        minimum: 0.0
      minMatchLength:
        description: Minimum length of extended k-mers
        type:
        - integer
        - 'null'
        format: uint
        minimum: 0.0
      minSeedCover:
        description: Fraction of the query sequence that has to be covered by extended seeds to proceed with the banded alignment.
        type:
        - number
        - 'null'
        format: double
      maxAlignmentAttempts:
        description: Number of times Nextclade will retry alignment with more relaxed results if alignment band boundaries are hit
        type:
        - integer
        - 'null'
        format: uint
        minimum: 0.0
      maxIndel:
        description: REMOVED
        anyOf:
        - $ref: '#/definitions/AnyType'
        - type: 'null'
      seedLength:
        description: REMOVED
        anyOf:
        - $ref: '#/definitions/AnyType'
        - type: 'null'
      mismatchesAllowed:
        description: REMOVED
        anyOf:
        - $ref: '#/definitions/AnyType'
        - type: 'null'
      minSeeds:
        description: REMOVED
        anyOf:
        - $ref: '#/definitions/AnyType'
        - type: 'null'
      minMatchRate:
        description: REMOVED
        anyOf:
        - $ref: '#/definitions/AnyType'
        - type: 'null'
      seedSpacing:
        description: REMOVED
        anyOf:
        - $ref: '#/definitions/AnyType'
        - type: 'null'
  AlignmentPreset:
    type: string
    enum:
    - default
    - high-diversity
    - short-sequences
  GapAlignmentSide:
    type: string
    enum:
    - left
    - right
  TreeBuilderParamsOptional:
    type: object
    properties:
      withoutGreedyTreeBuilder:
        description: Disable greedy tree builder algorithm
        type:
        - boolean
        - 'null'
      maskedMutsWeight:
        type:
        - number
        - 'null'
        format: double
  AaChangesParamsOptional:
    type: object
    properties:
      aa_group_spacing:
        type:
        - integer
        - 'null'
        format: uint
        minimum: 0.0
      aa_group_padding:
        type:
        - integer
        - 'null'
        format: uint
        minimum: 0.0
  PhenotypeData:
    type: object
    required:
    - aaRange
    - cds
    - data
    - description
    - name
    - nameFriendly
    properties:
      name:
        type: string
      nameFriendly:
        type: string
      description:
        type: string
      cds:
        type: string
      aaRange:
        $ref: '#/definitions/Range_for_Position'
      ignore:
        default:
          clades: []
        allOf:
        - $ref: '#/definitions/PhenotypeDataIgnore'
      data:
        type: array
        items:
          $ref: '#/definitions/PhenotypeDataEntry'
  PhenotypeDataIgnore:
    type: object
    properties:
      clades:
        default: []
        type: array
        items:
          type: string
  PhenotypeDataEntry:
    type: object
    required:
    - locations
    - name
    - weight
    properties:
      name:
        type: string
      weight:
        type: number
        format: double
      locations:
        type: object
        additionalProperties:
          $ref: '#/definitions/PhenotypeCoeff'
  PhenotypeCoeff:
    anyOf:
    - type: number
      format: double
    - type: object
      additionalProperties:
        type: number
        format: double
    - true
  AaMotifsDesc:
    type: object
    required:
    - description
    - motifs
    - name
    - nameFriendly
    - nameShort
    properties:
      name:
        type: string
      nameShort:
        type: string
      nameFriendly:
        type: string
      description:
        type: string
      motifs:
        type: array
        items:
          type: string
      includeCdses:
        type: array
        items:
          $ref: '#/definitions/CountAaMotifsCdsDesc'
  CountAaMotifsCdsDesc:
    type: object
    required:
    - cds
    properties:
      cds:
        type: string
      ranges:
        type: array
        items:
          $ref: '#/definitions/Range_for_Position'
  DatasetVersion:
    type: object
    required:
    - tag
    properties:
      tag:
        type: string
      updatedAt:
        type:
        - string
        - 'null'
      compatibility:
        anyOf:
        - $ref: '#/definitions/DatasetCompatibility'
        - type: 'null'
  DatasetCompatibility:
    type: object
    properties:
      cli:
        type: string
      web:
        type: string
